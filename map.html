<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <title>AWM Assignment 2</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
          integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z"
          crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
          integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
          crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
            integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
            crossorigin=""></script>

    <link rel = "stylesheet" href="dist/MarkerCluster.css">
    <link rel = "stylesheet" href="dist/MarkerCluster.Default.css">
    <link rel = "stylesheet" href="src/css/forms.css">

    <style>
        #map{height : 70vh;}
    </style>

<!--function to check the user authentication-->
    <script>
        function checkAuth(){
            $.ajax({
                type: "POST",
                headers: {
                    "Authorization": "Token " + localStorage.token
                },
                url: "https://ryankeogh.xyz/rest/api/check_auth/",
            }).done(function (data,status,xhr) {
                console.log("User is logged in");
            }).fail(function(data,status,xhr) {
                window.location.href = "login.html";
            });
        }
        checkAuth();
    </script>
    <!--navbar placement on page-->


    <div id="nav-placeholder"></div>
    <script>
        $.get("nav.html", function(data){
            $("#nav-placeholder").replaceWith(data);
        });
    </script>

</head>
<body>
<div id="map"></div>

<script>
    var map = L.map('map').setView([53.5, -8], 8);

    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);
    //
   navigator.geolocation.watchPosition(success,error);

    let marker, circle;


    function success(pos){

        const lng = pos.coords.longitude;
        const lat = pos.coords.latitude;
        const accuracy = pos.coords.accuracy;

        if(marker){
            map.removeLayer(marker);
            map.removeLayer(circle);
        }

        marker = L.marker([lat,lng]).addTo(map);
        circle = L.circle([lat,lng], {radius: accuracy}).addTo(map);

        map.flyTo([lat,lng], 14);

        console.log("called");
        update_db(lat,lng);
        //showPoiMarkers();


        console.log("Found location " )
    }

    function error(err){
        if(err.code ==1 ){
            alert("Please allow location access");
        } else{
            alert("Cannot get location");
        }
    }

</script>
<script src="dist/leaflet.markercluster.js"></script>
<script src="/index.js"></script>

<style>
    form-inline {text-align: center}
</style>
<div id="markers" style="padding: 0rem; width: 80%; position: relative">
    <form class="form-inline">
        <div class="form-group mb-2">
            <label for="poi" class="sr-only">Email</label>
            <input type="text" readonly class="form-control-plaintext" id="poi" value="Enter Point of Interest">
        </div>
        <div class="form-group mx-sm-3 mb-2">
            <label for="poiInput" class="sr-only"></label>
            <input type="text" class="form-control" id="poiInput" >
        </div>
    </form>
    <button id = "poiID" type="submit" class="btn btn-primary mb-2" onclick="showPoiMarkers2()"> Confirm</button>

</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</body>
<footer id = "footer" class="bg-light text-center text-lg-start">
    <div class="text-center p-3" style="background-color: darkolivegreen;">
        Â© Ryan Keogh
        <a class="text-dark">ryankeogh.xyz</a>
    </div>
</footer>
